<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>T√†i kho·∫£n - XSpace Store</title>
    <link rel="icon" href="https://i.imgur.com/k0zikhA.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Trust & Security Meta Tags -->
    <meta name="description" content="XSpace Store - Qu·∫£n l√Ω t√†i kho·∫£n ƒë·ªÉ t·∫£i ·ª©ng d·ª•ng iOS mi·ªÖn ph√≠. ƒêƒÉng k√Ω ho·∫∑c ƒëƒÉng nh·∫≠p ƒë·ªÉ truy c·∫≠p kho ·ª©ng d·ª•ng.">
    <meta name="keywords" content="iOS apps, t·∫£i ·ª©ng d·ª•ng, iPhone, iPad, t√†i kho·∫£n, ƒëƒÉng k√Ω, ƒëƒÉng nh·∫≠p">
    <meta name="author" content="XSpace Store">
    <meta name="robots" content="index, follow">
    <meta name="google-site-verification" content="YOUR_GOOGLE_VERIFICATION_CODE">
    <meta name="security" content="ssl">
    <meta property="og:title" content="XSpace Store - T√†i Kho·∫£n">
    <meta property="og:description" content="Qu·∫£n l√Ω t√†i kho·∫£n XSpace Store">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://modos.site/account.html">
    
    <!-- S·ª≠ d·ª•ng CSS ch√≠nh t·ª´ index.html -->
    <link rel="stylesheet" href="css/styles.css">
    
    <script src="js/config.js"></script>

    <style>
        /* Page-specific styles */
        :root {
            --primary:#2076f3; --primary-dark:#0cabeb; --primary-light:#e1f0ff;
            --success:#10b981; --danger:#ef4444; --warning:#f59e0b;
            --refresh-bg:#f1f5f9; --refresh-hover:#e1f0ff; --refresh-active:#d1e4ff;
            --premium: linear-gradient(135deg, #f59e0b, #eab308, #f97316);
        }
        
        [data-theme="dark"] {
            --primary: #3b82f6;
            --primary-dark: #1d4ed8;
            --primary-light: #1e293b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --refresh-bg: #1e293b;
            --refresh-hover: #2d3748;
            --refresh-active: #3c4b5f;
            --premium: linear-gradient(135deg, #f59e0b, #eab308, #f97316);
        }
        
        /* Ripple effect cho theme toggle */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.7);
            transform: scale(0);
            animation: ripple-animation 0.6s linear;
        }
        
        @keyframes ripple-animation {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        /* Pulse effect cho n√∫t Telegram */
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
            }
        }
        
        .telegram-btn:hover {
            animation: pulse 0.5s ease-in-out;
        }

        /* Main Content */
        .main-content {
            padding-top: 60px;
        }

        /* Welcome Section */
        .welcome-section { text-align:center; margin-bottom:20px; padding:0 12px; }
        .welcome-title { font-size:20px; font-weight:700; margin-bottom:8px; color:var(--text-primary); }
        .welcome-subtitle { font-size:14px; color:var(--text-secondary); line-height:1.5; }

        /* Account Container */
        .account-container { max-width:400px; margin:20px auto; padding:0 12px; }
        .auth-card { 
            background:var(--surface); border-radius:12px; overflow:hidden; 
            box-shadow:var(--card-shadow); border:1px solid var(--border); 
            padding:20px; transition:all .3s; 
        }
        .auth-card:hover { 
            transform:translateY(-2px); box-shadow:var(--card-shadow-hover); 
        }

        /* Tabs */
        .auth-tabs { 
            display:flex; margin-bottom:20px; 
            background:var(--surface); border-radius:10px; 
            padding:4px; border:1px solid var(--border); 
        }
        .auth-tab { 
            flex:1; padding:10px; border:none; background:transparent; 
            color:var(--text-secondary); border-radius:8px; 
            cursor:pointer; font-weight:600; font-size:13px; transition:all .3s; 
        }
        .auth-tab.active { 
            background:linear-gradient(90deg, var(--primary-dark), var(--primary)); 
            color:white; 
        }

        /* Forms */
        .auth-form { display:none; }
        .auth-form.active { display:block; }
        .form-group { margin-bottom:14px; }
        .form-label { 
            display:block; font-weight:600; margin-bottom:6px; 
            color:var(--text-primary); font-size:12px; 
            display:flex; align-items:center; gap:6px; 
        }
        .form-input { 
            width:100%; padding:10px 14px; border:1px solid var(--border); 
            border-radius:10px; font-size:13px; transition:all .3s; 
            background:var(--background); color:var(--text-primary); 
        }
        .form-input:focus { 
            outline:none; border-color:var(--primary); 
            box-shadow:0 0 0 3px rgba(32, 118, 243, 0.1); 
        }
        .submit-btn { 
            width:100%; background:linear-gradient(90deg, var(--primary-dark), var(--primary)); 
            color:white; border:none; padding:12px; border-radius:10px; 
            font-weight:700; cursor:pointer; transition:all .3s; 
            font-size:13px; margin-top:6px; 
            display:flex; align-items:center; justify-content:center; gap:8px; 
        }
        .submit-btn:hover { 
            background:linear-gradient(90deg, var(--primary), var(--primary-dark)); 
            transform:translateY(-1px); 
        }
        .submit-btn:disabled { 
            background:var(--text-muted); cursor:not-allowed; transform:none; 
        }

        /* Messages */
        .message { 
            padding:10px 14px; border-radius:10px; margin-bottom:14px; 
            display:none; align-items:center; gap:8px; 
            border:1px solid transparent; font-size:12px; 
        }
        .message-success { 
            background:rgba(16,185,129,0.1); color:var(--success); 
            border-color:rgba(16,185,129,0.2); 
        }
        .message-error { 
            background:rgba(239,68,68,0.1); color:var(--danger); 
            border-color:rgba(239,68,68,0.2); 
        }

        /* User Info */
        .user-info { display:none; text-align:center; }
        .user-info.active { display:block; }
        .user-avatar { 
            width:80px; height:80px; border-radius:50%; 
            background:linear-gradient(90deg, var(--primary-dark), var(--primary)); 
            color:white; display:flex; align-items:center; justify-content:center; 
            font-size:32px; font-weight:700; margin:0 auto 16px; 
            box-shadow:0 4px 8px rgba(12, 171, 235, 0.2); 
        }
        .user-name { font-size:20px; font-weight:700; margin-bottom:8px; color:var(--text-primary); }
        .user-details { 
            background:var(--surface); border-radius:12px; padding:16px; 
            margin:16px 0; border:1px solid var(--border); 
        }
        .user-detail { 
            color:var(--text-secondary); margin-bottom:8px; font-size:13px; 
            display:flex; align-items:center; justify-content:flex-start; gap:8px; padding:6px 0; 
        }
        .user-detail i { width:18px; color:var(--primary); }
        .user-badge { 
            display:inline-flex; align-items:center; gap:6px; 
            background:linear-gradient(90deg, var(--primary-dark), var(--primary)); 
            color:white; padding:6px 12px; border-radius:16px; 
            font-size:12px; font-weight:700; margin:10px 0; 
            box-shadow:0 2px 6px rgba(0,0,0,0.1); 
        }
        .user-badge.free { background:var(--text-muted); }
        .user-badge.trial { background:linear-gradient(90deg, #10b981, #0da271); }
        .user-badge.basic { background:linear-gradient(90deg, #3b82f6, #1d4ed8); }
        .user-badge.plus { background:linear-gradient(90deg, #8b5cf6, #7c3aed); }
        .user-badge.premium { 
            background:var(--premium); 
            box-shadow:0 2px 6px rgba(245,158,11,0.3); 
        }
        .user-badge i { font-size:14px; }
        .action-buttons { display:flex; flex-wrap:wrap; gap:10px; margin-top:20px; }
        .action-btn { 
            flex:1; min-width: calc(50% - 5px); padding:12px; 
            border:1px solid var(--border); border-radius:10px; 
            background:var(--surface); color:var(--text-primary); 
            cursor:pointer; font-weight:600; font-size:12px; transition:all .3s; 
            display:flex; align-items:center; justify-content:center; gap:6px; 
        }
        .action-btn:hover { 
            background:linear-gradient(90deg, var(--primary-dark), var(--primary)); 
            color:white; border-color:var(--primary); transform:translateY(-1px); 
        }
        .action-btn.logout { background:var(--danger); color:white; border-color:var(--danger); }
        .action-btn.logout:hover { background:#dc2626; }
        .action-btn.upgrade { background:var(--warning); color:white; border-color:var(--warning); }
        .action-btn.upgrade:hover { background:#d97706; }
        .action-btn.refresh { background:var(--refresh-bg); color:var(--text-secondary); border-color:var(--border); }
        .action-btn.refresh:hover { background:var(--refresh-hover); color:var(--primary); border-color:var(--primary); }
        .action-btn.change-password { background:linear-gradient(90deg, #10b981, #0da271); color:white; border-color:#10b981; }
        .action-btn.change-password:hover { background:linear-gradient(90deg, #0da271, #0c8a5c); }

        /* Last Refresh Time */
        .last-refresh {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px dashed var(--border);
            font-size: 11px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 8px;
        }
        .last-refresh i {
            font-size: 10px;
        }

        /* Change Password Modal */
        .change-password-modal { 
            display:none; position:fixed; top:0; left:0; right:0; bottom:0; 
            background:rgba(0,0,0,0.5); z-index:1000; 
            align-items:center; justify-content:center; padding:20px; 
        }
        .change-password-modal.active { display:flex; }
        .change-password-card { 
            background:var(--surface); border-radius:16px; padding:24px; 
            width:100%; max-width:400px; box-shadow:0 10px 25px rgba(0,0,0,0.2); 
            animation:modalAppear 0.3s ease-out; 
        }
        @keyframes modalAppear { 
            from { opacity:0; transform:scale(0.9); } 
            to { opacity:1; transform:scale(1); } 
        }
        .change-password-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:20px; }
        .change-password-title { font-size:18px; font-weight:700; color:var(--text-primary); display:flex; align-items:center; gap:8px; }
        .close-modal { 
            width:32px; height:32px; border-radius:8px; background:var(--surface); 
            border:1px solid var(--border); color:var(--text-secondary); cursor:pointer; 
            display:flex; align-items:center; justify-content:center; transition:all .3s; 
        }
        .close-modal:hover { background:var(--danger); color:white; border-color:var(--danger); }
        .change-password-form .form-group:last-child { margin-bottom:0; }
        .password-strength { margin-top:6px; font-size:11px; display:flex; align-items:center; gap:4px; }
        .strength-bar { flex:1; height:4px; background:var(--border); border-radius:2px; overflow:hidden; }
        .strength-fill { height:100%; width:0%; transition:all .3s; }
        .strength-weak .strength-fill { width:33%; background:var(--danger); }
        .strength-medium .strength-fill { width:66%; background:var(--warning); }
        .strength-strong .strength-fill { width:100%; background:var(--success); }

        /* Loading */
        .loading { display:inline-block; width:16px; height:16px; border:2px solid rgba(255,255,255,.3); border-radius:50%; border-top-color:#fff; animation:spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform:rotate(360deg); } }

        /* Quick Loading */
        .quick-loading { display:none; text-align:center; padding:20px; }
        .quick-loading.active { display:block; }
        .quick-loading .loading { width:24px; height:24px; margin-bottom:10px; }

        /* Consent Checkbox */
        .consent-group {
            background: var(--surface);
            padding: 12px;
            border-radius: 10px;
            border: 1px solid var(--border);
            margin-top: 15px;
            margin-bottom: 15px;
            display: none;
        }

        .consent-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            cursor: pointer;
        }

        .consent-checkbox input {
            margin-top: 3px;
        }

        .consent-text {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .consent-text a {
            color: var(--primary);
            text-decoration: none;
        }

        .consent-text a:hover {
            text-decoration: underline;
        }
        
        /* ===== CH·∫∂N LONG PRESS TR√äN NAV ITEMS CHO WKWEBVIEW iOS ===== */
        /* NgƒÉn ch·∫∑n menu context (m·ªü link) khi nh·∫•n gi·ªØ */
        .nav-item, .nav-icon, .nav-label {
            -webkit-touch-callout: none !important;
            -webkit-user-select: none !important;
            user-select: none !important;
            -webkit-tap-highlight-color: transparent !important;
        }
        
        /* T·∫Øt highlight khi ch·∫°m tr√™n iOS */
        .nav-item {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* V√¥ hi·ªáu h√≥a menu context cho t·∫•t c·∫£ nav items */
        .nav-items a {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* Ch·∫∑n menu context tr√™n to√†n b·ªô bottom nav */
        .bottom-nav {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* V√¥ hi·ªáu h√≥a h√†nh vi k√©o v√† th·∫£ tr√™n nav */
        .nav-item {
            touch-action: manipulation;
        }
        
        /* ƒê·∫£m b·∫£o kh√¥ng c√≥ text selection tr√™n nav */
        .nav-item * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* CSS ƒë·ªÉ ch·∫∑n context menu tr√™n iOS WKWebView */
        .no-context-menu {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* Prevent zoom on input focus */
        input, select, textarea {
            font-size: 16px !important;
            touch-action: manipulation;
        }
        
        /* Disable text size adjustment */
        html {
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }
        
        /* Responsive */
        @media (max-width:480px) {
            .account-container { padding:16px 0; margin:10px auto; }
            .auth-card { padding:16px; }
            .action-buttons { flex-direction:column; }
            .action-btn { min-width:100%; }
            .welcome-title { font-size:18px; }
            .welcome-subtitle { font-size:13px; }
            .change-password-card { padding:20px; margin:0 12px; }
        }
    </style>
</head>
<body>
    <!-- Header - ƒê·ªíNG B·ªò 100% V·ªöI INDEX.HTML -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">
                    <div class="logo-icon"><i class="fas fa-rocket"></i></div>
                    XSpace Store
                </a>
                <!-- Search bar ·∫©n gi·ªëng index.html -->
                <div class="search-bar" style="display: none;">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm ·ª©ng d·ª•ng...">
                </div>
                <div class="user-actions">
                    <!-- N√∫t chuy·ªÉn ƒë·ªïi ch·∫ø ƒë·ªô s√°ng/t·ªëi -->
                    <button class="icon-btn theme-toggle" id="themeToggle">
                        <i class="fas fa-sun theme-icon sun-icon"></i>
                        <i class="fas fa-moon theme-icon moon-icon"></i>
                    </button>
                    <!-- N√∫t Telegram -->
                    <a href="https://t.me/xspace_ipa" target="_blank" class="icon-btn telegram-btn" id="telegramBtn">
                        <i class="fas fa-bell"></i>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="account-container">
            <!-- Quick Loading -->
            <div class="quick-loading" id="quickLoading">
                <div class="loading"></div>
                <p>ƒêang t·∫£i th√¥ng tin...</p>
            </div>

            <!-- Messages -->
            <div id="successMessage" class="message message-success">
                <i class="fas fa-check-circle"></i>
                <span id="successText">Th√†nh c√¥ng!</span>
            </div>
            
            <div id="errorMessage" class="message message-error">
                <i class="fas fa-exclamation-circle"></i>
                <span id="errorText">ƒê√£ x·∫£y ra l·ªói!</span>
            </div>

            <!-- Welcome Section (shown when not logged in) -->
            <div class="welcome-section" id="welcomeSection">
                <h2 class="welcome-title">Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi XSpace Store</h2>
                <p class="welcome-subtitle">H√£y ƒëƒÉng nh·∫≠p ƒë·ªÉ tr·∫£i nghi·ªám kho ·ª©ng d·ª•ng m·ªôt c√°ch tr·ªçn v·∫πn nh·∫•t!</p>
            </div>

            <!-- Login/Register Forms -->
            <div id="authForms">
                <div class="auth-card">
                    <!-- Tabs -->
                    <div class="auth-tabs">
                        <button class="auth-tab active" data-form="loginForm">ƒêƒÉng nh·∫≠p</button>
                        <button class="auth-tab" data-form="registerForm">ƒêƒÉng k√Ω</button>
                    </div>

                    <!-- Login Form -->
                    <form class="auth-form active" id="loginForm">
                        <div class="form-group">
                            <label class="form-label" for="loginUsername">
                                <i class="fas fa-user"></i>
                                T√™n ƒëƒÉng nh·∫≠p
                            </label>
                            <input type="text" id="loginUsername" class="form-input" placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="loginPassword">
                                <i class="fas fa-lock"></i>
                                M·∫≠t kh·∫©u
                            </label>
                            <input type="password" id="loginPassword" class="form-input" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" required>
                        </div>

                        <button type="submit" class="submit-btn" id="loginBtn">
                            <i class="fas fa-sign-in-alt"></i>
                            ƒêƒÉng nh·∫≠p
                        </button>
                    </form>

                    <!-- Register Form -->
                    <form class="auth-form" id="registerForm">
                        <div class="form-group">
                            <label class="form-label" for="registerUsername">
                                <i class="fas fa-user"></i>
                                T√™n ƒëƒÉng nh·∫≠p
                            </label>
                            <input type="text" id="registerUsername" class="form-input" placeholder="Ch·ªçn t√™n ƒëƒÉng nh·∫≠p" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="registerEmail">
                                <i class="fas fa-envelope"></i>
                                Email
                            </label>
                            <input type="email" id="registerEmail" class="form-input" placeholder="Nh·∫≠p email c·ªßa b·∫°n" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="registerPassword">
                                <i class="fas fa-lock"></i>
                                M·∫≠t kh·∫©u
                            </label>
                            <input type="password" id="registerPassword" class="form-input" placeholder="T·∫°o m·∫≠t kh·∫©u" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="registerConfirmPassword">
                                <i class="fas fa-lock"></i>
                                Nh·∫≠p l·∫°i m·∫≠t kh·∫©u
                            </label>
                            <input type="password" id="registerConfirmPassword" class="form-input" placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u" required>
                        </div>

                        <!-- Consent Checkbox -->
                        <div class="consent-group" id="consentGroup">
                            <label class="consent-checkbox">
                                <input type="checkbox" id="privacyConsent" required>
                                <span class="consent-text">
                                    T√¥i ƒë·ªìng √Ω v·ªõi <a href="privacy-policy.html" target="_blank">Ch√≠nh S√°ch B·∫£o M·∫≠t</a> 
                                    v√† <a href="terms-of-service.html" target="_blank">ƒêi·ªÅu Kho·∫£n D·ªãch V·ª•</a> c·ªßa XSpace Store
                                </span>
                            </label>
                        </div>

                        <button type="submit" class="submit-btn" id="registerBtn">
                            <i class="fas fa-user-plus"></i>
                            ƒêƒÉng k√Ω t√†i kho·∫£n
                        </button>
                    </form>
                </div>
            </div>

            <!-- User Info (shown after login) -->
            <div class="user-info" id="userInfo">
                <div class="auth-card">
                    <div class="user-avatar" id="userAvatar">
                        <i class="fas fa-user"></i>
                    </div>
                    
                    <h2 class="user-name" id="userName">Ng∆∞·ªùi d√πng</h2>
                    
                    <div class="user-details">
                        <div class="user-detail">
                            <i class="fas fa-envelope"></i>
                            <span>Email: <strong id="userEmail">user@example.com</strong></span>
                        </div>
                        
                        <div class="user-detail">
                            <i class="fas fa-calendar"></i>
                            <span>Ng√†y tham gia: <strong id="userCreatedDate">01/01/2024</strong></span>
                        </div>
                        
                        <div class="user-detail" id="vipExpiryInfo" style="display: none;">
                            <i class="fas fa-crown"></i>
                            <span>VIP ƒë·∫øn: <strong id="vipExpiryDate">01/01/2024</strong></span>
                        </div>
                        
                        <div class="user-detail" id="vipStatusInfo" style="display: none;">
                            <i class="fas fa-check-circle"></i>
                            <span>Tr·∫°ng th√°i: <strong id="vipStatusText">ƒêang ho·∫°t ƒë·ªông</strong></span>
                        </div>
                        
                        <!-- Last Refresh Time -->
                        <div class="last-refresh">
                            <i class="fas fa-clock"></i>
                            <span>C·∫≠p nh·∫≠t l·∫ßn cu·ªëi: <strong id="lastRefreshTime">--:--:--</strong></span>
                        </div>
                    </div>
                    
                    <div class="user-badge free" id="userBadge">
                        <i class="fas fa-user"></i>
                        <span>T√†i kho·∫£n Mi·ªÖn ph√≠</span>
                    </div>

                    <div class="action-buttons">
                        <button class="action-btn change-password" id="changePasswordBtn">
                            <i class="fas fa-key"></i>
                            ƒê·ªïi m·∫≠t kh·∫©u
                        </button>
                        <button class="action-btn upgrade" id="upgradeBtn">
                            <i class="fas fa-crown"></i>
                            N√¢ng c·∫•p VIP
                        </button>
                        <button class="action-btn refresh" id="refreshBtn">
                            <i class="fas fa-sync-alt"></i>
                            L√†m m·ªõi
                        </button>
                        <button class="action-btn logout" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            ƒêƒÉng xu·∫•t
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="page-footer">
        <div class="container">
            <div class="footer-content">
                <p class="copyright">
                    Copyright ¬©2024 Vietnam Signing Authority . All rights reserved
                </p>
                
                <div class="footer-links">
                    <a href="privacy-policy.html" target="_blank" class="footer-link">
                        <i class="fas fa-shield-alt"></i>
                        Ch√≠nh S√°ch B·∫£o M·∫≠t
                    </a>
                    
                    <span class="footer-divider">‚Ä¢</span>
                    
                    <a href="terms-of-service.html" target="_blank" class="footer-link">
                        <i class="fas fa-file-contract"></i>
                        ƒêi·ªÅu Kho·∫£n D·ªãch V·ª•
                    </a>
                    
                    <span class="footer-divider">‚Ä¢</span>
                    
                    <a href="mailto:support@modos.site" class="footer-link">
                        <i class="fas fa-headset"></i>
                        Li√™n H·ªá H·ªó Tr·ª£
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Change Password Modal -->
    <div class="change-password-modal" id="changePasswordModal">
        <div class="change-password-card">
            <div class="change-password-header">
                <h3 class="change-password-title">
                    <i class="fas fa-key"></i>
                    ƒê·ªïi m·∫≠t kh·∫©u
                </h3>
                <button class="close-modal" id="closeChangePasswordModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="changePasswordForm">
                <div class="form-group">
                    <label class="form-label" for="oldPassword">
                        <i class="fas fa-lock"></i>
                        M·∫≠t kh·∫©u hi·ªán t·∫°i
                    </label>
                    <input type="password" id="oldPassword" class="form-input" placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="newPassword">
                        <i class="fas fa-lock"></i>
                        M·∫≠t kh·∫©u m·ªõi
                    </label>
                    <input type="password" id="newPassword" class="form-input" placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi" required>
                    <div class="password-strength" id="passwordStrength">
                        <span>ƒê·ªô m·∫°nh:</span>
                        <div class="strength-bar">
                            <div class="strength-fill"></div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="confirmNewPassword">
                        <i class="fas fa-lock"></i>
                        Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi
                    </label>
                    <input type="password" id="confirmNewPassword" class="form-input" placeholder="X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi" required>
                </div>
                
                <button type="submit" class="submit-btn" id="submitChangePasswordBtn">
                    <i class="fas fa-check"></i>
                    C·∫≠p nh·∫≠t m·∫≠t kh·∫©u
                </button>
            </form>
        </div>
    </div>

    <!-- Bottom Navigation - ƒê·ªíNG B·ªò 100% V·ªöI INDEX.HTML -->
    <nav class="bottom-nav no-context-menu">
        <div class="container">
            <div class="nav-items">
                <a href="index.html" class="nav-item" data-view="home">
                    <div class="nav-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <div class="nav-label">Trang ch·ªß</div>
                </a>
                <a href="index.html#gamesSection" class="nav-item" data-view="games">
                    <div class="nav-icon">
                        <i class="fas fa-gamepad"></i>
                    </div>
                    <div class="nav-label">Tr√≤ ch∆°i</div>
                </a>
                <a href="index.html" class="nav-item" data-view="search" id="searchNavItem">
                    <div class="nav-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="nav-label">T√¨m ki·∫øm</div>
                </a>
                <a href="info.html" class="nav-item">
                    <div class="nav-icon">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="nav-label">Th√¥ng tin</div>
                </a>
                <a href="account.html" class="nav-item active">
                    <div class="nav-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="nav-label">T√†i kho·∫£n</div>
                </a>
            </div>
        </div>
    </nav>

    <script>
        // CONFIG ƒë∆∞·ª£c l·∫•y t·ª´ config.js ƒë√£ load ·ªü tr√™n
        
        // DOM Elements
        const authTabs = document.querySelectorAll('.auth-tab');
        const authForms = document.querySelectorAll('.auth-form');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const authFormsContainer = document.getElementById('authForms');
        const userInfo = document.getElementById('userInfo');
        const welcomeSection = document.getElementById('welcomeSection');
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const upgradeBtn = document.getElementById('upgradeBtn');
        const refreshBtn = document.getElementById('refreshBtn');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const changePasswordModal = document.getElementById('changePasswordModal');
        const closeChangePasswordModal = document.getElementById('closeChangePasswordModal');
        const changePasswordForm = document.getElementById('changePasswordForm');
        const submitChangePasswordBtn = document.getElementById('submitChangePasswordBtn');
        const newPasswordInput = document.getElementById('newPassword');
        const passwordStrength = document.getElementById('passwordStrength');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        const successText = document.getElementById('successText');
        const errorText = document.getElementById('errorText');
        const quickLoading = document.getElementById('quickLoading');
        const lastRefreshTimeElement = document.getElementById('lastRefreshTime');
        const vipStatusInfo = document.getElementById('vipStatusInfo');
        const vipStatusText = document.getElementById('vipStatusText');
        const vipExpiryInfo = document.getElementById('vipExpiryInfo');
        const privacyConsent = document.getElementById('privacyConsent');
        const consentGroup = document.getElementById('consentGroup');
        
        // Theme management
        const themeToggle = document.getElementById('themeToggle');
        const htmlElement = document.documentElement;

        // AUTO REFRESH SYSTEM
        let autoRefreshInterval = null;
        let lastRefreshTime = null;

        // Theme Manager Class
        class ThemeManager {
            constructor() {
                this.themeToggle = document.getElementById('themeToggle');
                this.htmlElement = document.documentElement;
                this.body = document.body;
                this.init();
            }
            
            init() {
                // Ki·ªÉm tra theme ƒë√£ l∆∞u
                const savedTheme = localStorage.getItem('theme');
                
                // √Åp d·ª•ng theme ƒë√£ l∆∞u ho·∫∑c m·∫∑c ƒë·ªãnh (light)
                if (savedTheme === 'dark') {
                    this.setTheme('dark');
                } else {
                    // M·∫∑c ƒë·ªãnh l√† light mode
                    this.setTheme('light');
                    localStorage.setItem('theme', 'light');
                }
                
                // Th√™m s·ª± ki·ªán click cho n√∫t chuy·ªÉn ƒë·ªïi
                this.themeToggle.addEventListener('click', (e) => this.toggleTheme(e));
            }
            
            setTheme(theme) {
                const isDark = theme === 'dark';
                this.htmlElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                
                // C·∫≠p nh·∫≠t icon
                this.updateThemeIcon(isDark);
                
                // C·∫≠p nh·∫≠t meta theme-color cho vi·ªÅn tr√™n c√πng
                this.updateMetaThemeColor(isDark);
            }
            
            toggleTheme(e) {
                const currentTheme = this.htmlElement.getAttribute('data-theme');
                const isDark = currentTheme === 'dark';
                this.setTheme(isDark ? 'light' : 'dark');
                
                // Th√™m hi·ªáu ·ª©ng ripple
                this.createRippleEffect(e);
            }
            
            updateThemeIcon(isDark) {
                const sunIcon = this.themeToggle.querySelector('.sun-icon');
                const moonIcon = this.themeToggle.querySelector('.moon-icon');
                
                if (isDark) {
                    sunIcon.style.opacity = '0';
                    sunIcon.style.transform = 'rotate(90deg) scale(0.5)';
                    moonIcon.style.opacity = '1';
                    moonIcon.style.transform = 'rotate(0deg) scale(1)';
                } else {
                    sunIcon.style.opacity = '1';
                    sunIcon.style.transform = 'rotate(0deg) scale(1)';
                    moonIcon.style.opacity = '0';
                    moonIcon.style.transform = 'rotate(-90deg) scale(0.5)';
                }
            }
            
            updateMetaThemeColor(isDark) {
                // C·∫≠p nh·∫≠t m√†u theme cho thanh ƒë·ªãa ch·ªâ v√† UI tr√¨nh duy·ªát
                const themeColor = isDark ? '#0f172a' : '#ffffff';
                
                let metaThemeColor = document.querySelector('meta[name="theme-color"]');
                if (!metaThemeColor) {
                    metaThemeColor = document.createElement('meta');
                    metaThemeColor.name = 'theme-color';
                    document.head.appendChild(metaThemeColor);
                }
                metaThemeColor.content = themeColor;
                
                // C·∫≠p nh·∫≠t m√†u cho Safari
                let metaAppleThemeColor = document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]');
                if (!metaAppleThemeColor) {
                    metaAppleThemeColor = document.createElement('meta');
                    metaAppleThemeColor.name = 'apple-mobile-web-app-status-bar-style';
                    document.head.appendChild(metaAppleThemeColor);
                }
                metaAppleThemeColor.content = isDark ? 'black' : 'default';
            }
            
            createRippleEffect(event) {
                const button = event.currentTarget;
                const circle = document.createElement('span');
                const diameter = Math.max(button.clientWidth, button.clientHeight);
                const radius = diameter / 2;
                
                circle.style.width = circle.style.height = `${diameter}px`;
                circle.style.left = `${event.clientX - button.getBoundingClientRect().left - radius}px`;
                circle.style.top = `${event.clientY - button.getBoundingClientRect().top - radius}px`;
                circle.classList.add('ripple');
                
                const ripple = button.getElementsByClassName('ripple')[0];
                if (ripple) {
                    ripple.remove();
                }
                
                button.appendChild(circle);
                
                // X√≥a ripple sau khi animation k·∫øt th√∫c
                setTimeout(() => {
                    if (circle.parentNode === button) {
                        button.removeChild(circle);
                    }
                }, 600);
            }
        }
        
        // ===== CH·∫∂N LONG PRESS (CONTEXT MENU) TR√äN NAV ITEMS =====
        class LongPressBlocker {
            constructor() {
                this.navItems = document.querySelectorAll('.nav-item');
                this.init();
            }
            
            init() {
                console.log('üõ°Ô∏è Initializing long press blocker for nav items');
                
                // √Åp d·ª•ng cho t·∫•t c·∫£ nav items
                this.navItems.forEach(item => {
                    // NgƒÉn context menu
                    item.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        return false;
                    });
                    
                    // NgƒÉn touch hold tr√™n iOS
                    item.addEventListener('touchstart', (e) => {
                        // Kh√¥ng l√†m g√¨ c·∫£, ch·ªâ ƒë·ªÉ ngƒÉn h√†nh vi m·∫∑c ƒë·ªãnh
                    }, { passive: true });
                    
                    item.addEventListener('touchend', (e) => {
                        // NgƒÉn m·ªü context menu
                        if (e.timeStamp - e.currentTarget.touchStartTime > 500) {
                            e.preventDefault();
                        }
                    });
                    
                    item.addEventListener('touchmove', (e) => {
                        // NgƒÉn khi ng∆∞·ªùi d√πng di chuy·ªÉn ng√≥n tay
                        e.currentTarget.touchMoved = true;
                    });
                    
                    // Th√™m touch start time tracking
                    item.addEventListener('touchstart', (e) => {
                        e.currentTarget.touchStartTime = e.timeStamp;
                        e.currentTarget.touchMoved = false;
                    });
                    
                    // JavaScript fallback ƒë·ªÉ ch·∫∑n text selection
                    item.addEventListener('selectstart', (e) => {
                        e.preventDefault();
                        return false;
                    });
                });
                
                // Th√™m global context menu blocker
                document.addEventListener('contextmenu', (e) => {
                    // Ch·ªâ ch·∫∑n tr√™n nav items
                    if (e.target.closest('.nav-item') || e.target.closest('.bottom-nav')) {
                        e.preventDefault();
                        return false;
                    }
                }, false);
                
                // NgƒÉn text selection tr√™n to√†n b·ªô bottom nav
                const bottomNav = document.querySelector('.bottom-nav');
                if (bottomNav) {
                    bottomNav.addEventListener('selectstart', (e) => {
                        e.preventDefault();
                        return false;
                    });
                    
                    bottomNav.style.userSelect = 'none';
                    bottomNav.style.webkitUserSelect = 'none';
                }
            }
        }
        
        // ===== WKWEBVIEW iOS SPECIFIC FIXES =====
        class WKWebViewFixer {
            constructor() {
                this.isWKWebView = this.detectWKWebView();
                this.init();
            }
            
            detectWKWebView() {
                const ua = navigator.userAgent;
                const isIOS = /iPad|iPhone|iPod/.test(ua) && !window.MSStream;
                const isWebKit = /WebKit/.test(ua);
                const isChrome = /CriOS/.test(ua);
                
                // WKWebView iOS detection
                return isIOS && isWebKit && !isChrome && window.webkit && window.webkit.messageHandlers;
            }
            
            init() {
                if (!this.isWKWebView) return;
                
                console.log('üì± WKWebView iOS detected, applying fixes');
                
                // √Åp d·ª•ng CSS fixes
                this.applyCSSFixes();
                
                // √Åp d·ª•ng JavaScript fixes
                this.applyJSFixes();
                
                // NgƒÉn bounce/scrolling issues
                this.preventBounce();
            }
            
            applyCSSFixes() {
                // Th√™m CSS fixes cho WKWebView
                const style = document.createElement('style');
                style.textContent = `
                    /* WKWebView specific fixes */
                    .nav-item {
                        -webkit-touch-callout: none !important;
                        -webkit-user-select: none !important;
                        user-select: none !important;
                        cursor: pointer !important;
                    }
                    
                    /* T·∫Øt highlight tr√™n iOS */
                    .nav-item:active {
                        background-color: transparent !important;
                    }
                    
                    /* NgƒÉn text selection ho√†n to√†n */
                    .bottom-nav, .nav-items, .nav-item, .nav-icon, .nav-label {
                        -webkit-user-select: none !important;
                        -moz-user-select: none !important;
                        -ms-user-select: none !important;
                        user-select: none !important;
                    }
                    
                    /* T·∫Øt tap highlight */
                    * {
                        -webkit-tap-highlight-color: rgba(0,0,0,0) !important;
                        -webkit-tap-highlight-color: transparent !important;
                    }
                `;
                document.head.appendChild(style);
            }
            
            applyJSFixes() {
                // NgƒÉn m·ªçi h√†nh vi kh√¥ng mong mu·ªën tr√™n nav items
                document.addEventListener('touchstart', (e) => {
                    const navItem = e.target.closest('.nav-item');
                    if (navItem) {
                        // NgƒÉn m·ªçi h√†nh vi m·∫∑c ƒë·ªãnh
                        e.preventDefault();
                        
                        // Th√™m class active t·∫°m th·ªùi
                        navItem.classList.add('active-touch');
                        
                        // X√≥a class sau 150ms
                        setTimeout(() => {
                            navItem.classList.remove('active-touch');
                        }, 150);
                    }
                }, { passive: false });
                
                // NgƒÉn context menu ho√†n to√†n
                document.addEventListener('contextmenu', (e) => {
                    if (e.target.closest('.nav-item') || e.target.closest('.bottom-nav')) {
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                    }
                });
                
                // NgƒÉn text selection
                document.addEventListener('selectstart', (e) => {
                    if (e.target.closest('.nav-item') || e.target.closest('.bottom-nav')) {
                        e.preventDefault();
                        return false;
                    }
                });
            }
            
            preventBounce() {
                // NgƒÉn bounce effect tr√™n WKWebView
                document.body.style.overflow = 'hidden';
                document.body.style.position = 'fixed';
                document.body.style.width = '100%';
                document.body.style.height = '100%';
            }
        }

        // Format date function
        function formatDate(dateString) {
            if (!dateString) return 'Kh√¥ng x√°c ƒë·ªãnh';
            
            if (dateString.includes('T')) {
                const date = new Date(dateString);
                return date.toLocaleDateString('vi-VN');
            }
            
            if (dateString.includes('/')) {
                return dateString;
            }
            
            return dateString;
        }

        // Parse date function
        function parseDate(dateString) {
            if (!dateString || dateString === '') return null;
            
            try {
                // Th·ª≠ parse ISO format
                if (dateString.includes('T')) {
                    return new Date(dateString);
                }
                
                // Th·ª≠ parse dd/mm/yyyy format
                if (dateString.includes('/')) {
                    const parts = dateString.split('/');
                    if (parts.length === 3) {
                        const day = parseInt(parts[0]);
                        const month = parseInt(parts[1]) - 1;
                        const year = parseInt(parts[2]);
                        const fullYear = year < 100 ? year + 2000 : year;
                        return new Date(fullYear, month, day);
                    }
                }
                
                return new Date(dateString);
            } catch (error) {
                console.error('Error parsing date:', dateString, error);
                return null;
            }
        }

        // AUTO REFRESH FUNCTIONS
        function startAutoRefresh(userEmail) {
            if (!userEmail) return;
            
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            
            performAutoRefresh(userEmail);
            
            autoRefreshInterval = setInterval(() => {
                performAutoRefresh(userEmail);
            }, 5000);
        }

        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
        }

        async function performAutoRefresh(userEmail) {
            try {
                const response = await fetch(`${CONFIG.GOOGLE_SCRIPT_URL}?action=autoRefreshUser&email=${encodeURIComponent(userEmail)}`);
                const result = await response.json();
                
                if (result.success && result.autoRefreshed) {
                    const userData = result.data;
                    updateUserUI(userData);
                    localStorage.setItem('currentUser', JSON.stringify(userData));
                    
                    lastRefreshTime = new Date().toLocaleTimeString('vi-VN');
                    lastRefreshTimeElement.textContent = lastRefreshTime;
                }
            } catch (error) {
                console.error('L·ªói khi auto refresh:', error);
            }
        }

        // H√†m c·∫≠p nh·∫≠t UI
        function updateUserUI(userData) {
            if (!userData) return;
            
            console.log('Updating UI with data:', userData);
            
            // C·∫≠p nh·∫≠t th√¥ng tin c∆° b·∫£n
            document.getElementById('userName').textContent = userData.username || 'Ng∆∞·ªùi d√πng';
            document.getElementById('userEmail').textContent = userData.email || 'Ch∆∞a c√≥ email';
            document.getElementById('userCreatedDate').textContent = formatDate(userData.createdDate) || 'Kh√¥ng x√°c ƒë·ªãnh';
            
            // Set avatar v·ªõi ch·ªØ c√°i ƒë·∫ßu c·ªßa username
            const firstLetter = (userData.username || 'U').charAt(0).toUpperCase();
            document.getElementById('userAvatar').innerHTML = firstLetter;
            
            // Update badge v√† VIP info
            const userBadge = document.getElementById('userBadge');
            const vipExpiryDate = document.getElementById('vipExpiryDate');
            const upgradeBtn = document.getElementById('upgradeBtn');
            
            const packageInfo = {
                'free': { name: 'Mi·ªÖn ph√≠', class: 'free', icon: 'fas fa-user' },
                'trial': { name: 'Trial', class: 'trial', icon: 'fas fa-star' },
                'basic': { name: 'Basic', class: 'basic', icon: 'fas fa-crown' },
                'plus': { name: 'Plus', class: 'plus', icon: 'fas fa-crown' },
                'premium': { name: 'Premium', class: 'premium', icon: 'fas fa-crown' }
            };
            
            const packageType = userData.packageType || 'free';
            const currentPackage = packageInfo[packageType] || packageInfo.free;
            
            // C·∫≠p nh·∫≠t g√≥i t√†i kho·∫£n
            userBadge.innerHTML = `<i class="${currentPackage.icon}"></i><span>T√†i kho·∫£n ${currentPackage.name}</span>`;
            userBadge.className = `user-badge ${currentPackage.class}`;
            
            // C·∫≠p nh·∫≠t th√¥ng tin VIP expiry
            if (userData.vipExpiry && userData.vipExpiry !== '') {
                vipExpiryDate.textContent = formatDate(userData.vipExpiry);
                vipExpiryInfo.style.display = 'flex';
            } else {
                vipExpiryInfo.style.display = 'none';
            }
            
            // FIX LOGIC HI·ªÇN TH·ªä TR·∫†NG TH√ÅI VIP
            if (packageType !== 'free') {
                vipStatusInfo.style.display = 'flex';
                
                // S·ª≠ d·ª•ng tr·∫°ng th√°i t·ª´ server n·∫øu c√≥
                const vipStatus = userData.vipStatus || 'free';
                
                if (vipStatus === 'active') {
                    vipStatusText.textContent = 'ƒêang ho·∫°t ƒë·ªông';
                    vipStatusText.style.color = 'var(--success)';
                    upgradeBtn.style.display = 'none';
                } else if (vipStatus === 'expired') {
                    vipStatusText.textContent = 'ƒê√£ h·∫øt h·∫°n';
                    vipStatusText.style.color = 'var(--danger)';
                    upgradeBtn.style.display = 'flex';
                } else {
                    // Ki·ªÉm tra ng√†y h·∫øt h·∫°n ƒë·ªÉ x√°c ƒë·ªãnh
                    if (userData.vipExpiry && userData.vipExpiry !== '') {
                        const expiryDate = parseDate(userData.vipExpiry);
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);
                        
                        if (expiryDate && !isNaN(expiryDate.getTime())) {
                            expiryDate.setHours(0, 0, 0, 0);
                            
                            if (expiryDate >= today) {
                                vipStatusText.textContent = 'ƒêang ho·∫°t ƒë·ªông';
                                vipStatusText.style.color = 'var(--success)';
                                upgradeBtn.style.display = 'none';
                            } else {
                                vipStatusText.textContent = 'ƒê√£ h·∫øt h·∫°n';
                                vipStatusText.style.color = 'var(--danger)';
                                upgradeBtn.style.display = 'flex';
                            }
                        } else {
                            vipStatusText.textContent = 'Kh√¥ng x√°c ƒë·ªãnh';
                            vipStatusText.style.color = 'var(--warning)';
                            upgradeBtn.style.display = 'flex';
                        }
                    } else {
                        vipStatusText.textContent = 'Kh√¥ng x√°c ƒë·ªãnh';
                        vipStatusText.style.color = 'var(--warning)';
                        upgradeBtn.style.display = 'flex';
                    }
                }
            } else {
                vipStatusInfo.style.display = 'none';
                upgradeBtn.style.display = 'flex';
            }
            
            // C·∫≠p nh·∫≠t th·ªùi gian refresh
            lastRefreshTimeElement.textContent = lastRefreshTime || '--:--:--';
        }

        // Check if user is already logged in
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Loaded - Checking for CONFIG');
            
            if (typeof CONFIG === 'undefined' || !CONFIG.GOOGLE_SCRIPT_URL) {
                console.error('L·ªói: Kh√¥ng t√¨m th·∫•y CONFIG ho·∫∑c GOOGLE_SCRIPT_URL');
                showError('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server. Vui l√≤ng th·ª≠ l·∫°i sau.');
                return;
            }
            
            console.log('CONFIG found:', CONFIG.GOOGLE_SCRIPT_URL);
            
            // Kh·ªüi t·∫°o theme manager v√† long press blocker
            const themeManager = new ThemeManager();
            const longPressBlocker = new LongPressBlocker();
            const wkWebViewFixer = new WKWebViewFixer();
            
            // Ki·ªÉm tra v√† √°p d·ª•ng theme ngay l·∫≠p t·ª©c ƒë·ªÉ tr√°nh flash
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
            
            // X·ª≠ l√Ω n√∫t Telegram
            document.getElementById('telegramBtn').addEventListener('click', function(e) {
                window.open(this.href, '_blank');
            });
            
            // Ki·ªÉm tra ng∆∞·ªùi d√πng ƒëƒÉng nh·∫≠p
            const currentUser = getCurrentUser();
            console.log('Current user from localStorage:', currentUser);
            
            if (currentUser) {
                // Hi·ªÉn th·ªã th√¥ng tin ng∆∞·ªùi d√πng ngay l·∫≠p t·ª©c
                loadUserInfo(currentUser, true);
                
                // Sau ƒë√≥ t·∫£i th√¥ng tin m·ªõi nh·∫•t t·ª´ server
                refreshUserInfo(currentUser);
            } else {
                // Hi·ªÉn th·ªã form ƒëƒÉng nh·∫≠p/ƒëƒÉng k√Ω v√† welcome section
                authFormsContainer.style.display = 'block';
                welcomeSection.style.display = 'block';
                userInfo.style.display = 'none';
                quickLoading.style.display = 'none';
                console.log('No user logged in, showing auth forms');
            }
            
            // D·ª´ng auto refresh khi r·ªùi trang
            window.addEventListener('beforeunload', function() {
                stopAutoRefresh();
            });
        });

        // Tab switching v·ªõi hi·ªÉn th·ªã consent checkbox
        authTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const formId = tab.getAttribute('data-form');
                
                authTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                authForms.forEach(form => {
                    form.classList.remove('active');
                    if (form.id === formId) {
                        form.classList.add('active');
                    }
                });
                
                // Hi·ªÉn th·ªã consent ch·ªâ ·ªü form ƒëƒÉng k√Ω
                if (formId === 'registerForm') {
                    consentGroup.style.display = 'block';
                } else {
                    consentGroup.style.display = 'none';
                }
            });
        });

        // Login form submission
        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('Login form submitted');
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            
            if (!username || !password) {
                showError('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin');
                return;
            }
            
            loginBtn.innerHTML = '<div class="loading"></div> ƒêang ƒëƒÉng nh·∫≠p...';
            loginBtn.disabled = true;
            
            try {
                console.log('Sending login request to:', CONFIG.GOOGLE_SCRIPT_URL);
                
                const response = await fetch(CONFIG.GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8',
                    },
                    body: JSON.stringify({
                        action: 'loginUser',
                        data: {
                            username: username,
                            password: password
                        }
                    })
                });
                
                console.log('Response received, status:', response.status);
                const result = await response.json();
                console.log('Login result:', result);
                
                if (result.success) {
                    // Save user info to localStorage
                    localStorage.setItem('currentUser', JSON.stringify(result.data));
                    console.log('User saved to localStorage:', result.data);
                    
                    // Hi·ªÉn th·ªã th√¥ng tin user v√† ·∫©n form ƒëƒÉng nh·∫≠p
                    loadUserInfo(result.data, false);
                    
                    if (result.data.autoDowngraded) {
                        showSuccess('ƒêƒÉng nh·∫≠p th√†nh c√¥ng! T√†i kho·∫£n VIP c·ªßa b·∫°n ƒë√£ h·∫øt h·∫°n v√† ƒë∆∞·ª£c chuy·ªÉn v·ªÅ mi·ªÖn ph√≠.');
                    } else {
                        showSuccess('ƒêƒÉng nh·∫≠p th√†nh c√¥ng!');
                    }
                    
                    // B·∫≠t auto refresh
                    startAutoRefresh(result.data.email);
                } else {
                    throw new Error(result.message || 'ƒêƒÉng nh·∫≠p th·∫•t b·∫°i');
                }
            } catch (error) {
                console.error('Login error:', error);
                showError(error.message || 'ƒêƒÉng nh·∫≠p th·∫•t b·∫°i. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng.');
            } finally {
                loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> ƒêƒÉng nh·∫≠p';
                loginBtn.disabled = false;
            }
        });

        // Register form submission v·ªõi consent check
        registerForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('registerUsername').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value.trim();
            const confirmPassword = document.getElementById('registerConfirmPassword').value.trim();
            
            if (!username || !email || !password || !confirmPassword) {
                showError('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin');
                return;
            }
            
            if (password !== confirmPassword) {
                showError('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp');
                return;
            }
            
            if (password.length < 6) {
                showError('M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±');
                return;
            }
            
            if (!isValidEmail(email)) {
                showError('Email kh√¥ng h·ª£p l·ªá');
                return;
            }
            
            // QUAN TR·ªåNG: Ki·ªÉm tra consent
            if (!privacyConsent.checked) {
                showError('Vui l√≤ng ƒë·ªìng √Ω v·ªõi Ch√≠nh S√°ch B·∫£o M·∫≠t v√† ƒêi·ªÅu Kho·∫£n D·ªãch V·ª•');
                return;
            }
            
            registerBtn.innerHTML = '<div class="loading"></div> ƒêang ƒëƒÉng k√Ω...';
            registerBtn.disabled = true;
            
            try {
                // Th√™m x√°c th·ª±c human interaction ƒë·ªÉ tr√°nh b·ªã flag
                const humanToken = await generateHumanToken();
                
                const response = await fetch(CONFIG.GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8',
                    },
                    body: JSON.stringify({
                        action: 'registerUser',
                        data: {
                            username: username,
                            password: password,
                            email: email,
                            humanToken: humanToken,
                            consent: true,
                            timestamp: new Date().toISOString()
                        }
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showSuccess('ƒêƒÉng k√Ω th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p.');
                    authTabs[0].click();
                    registerForm.reset();
                    privacyConsent.checked = false;
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                showError(error.message || 'ƒêƒÉng k√Ω th·∫•t b·∫°i');
            } finally {
                registerBtn.innerHTML = '<i class="fas fa-user-plus"></i> ƒêƒÉng k√Ω t√†i kho·∫£n';
                registerBtn.disabled = false;
            }
        });

        // Logout
        logoutBtn.addEventListener('click', function() {
            stopAutoRefresh();
            localStorage.removeItem('currentUser');
            authFormsContainer.style.display = 'block';
            welcomeSection.style.display = 'block';
            userInfo.classList.remove('active');
            userInfo.style.display = 'none';
            showSuccess('ƒê√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng');
        });

        // Upgrade button
        upgradeBtn.addEventListener('click', function() {
            window.location.href = 'payment.html';
        });

        // Refresh user info
        refreshBtn.addEventListener('click', async function() {
            const currentUser = getCurrentUser();
            if (currentUser) {
                refreshBtn.innerHTML = '<div class="loading"></div> ƒêang l√†m m·ªõi...';
                try {
                    await refreshUserInfo(currentUser);
                    showSuccess('ƒê√£ c·∫≠p nh·∫≠t th√¥ng tin t√†i kho·∫£n!');
                } catch (error) {
                    showError(error.message || 'L·ªói khi l√†m m·ªõi th√¥ng tin');
                } finally {
                    refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> L√†m m·ªõi';
                }
            }
        });

        // Change password modal
        changePasswordBtn.addEventListener('click', function() {
            changePasswordModal.classList.add('active');
            changePasswordForm.reset();
            passwordStrength.className = 'password-strength';
        });

        closeChangePasswordModal.addEventListener('click', function() {
            changePasswordModal.classList.remove('active');
        });

        changePasswordModal.addEventListener('click', function(e) {
            if (e.target === changePasswordModal) {
                changePasswordModal.classList.remove('active');
            }
        });

        // Password strength checker
        newPasswordInput.addEventListener('input', function() {
            const password = newPasswordInput.value;
            let strength = 0;
            
            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            passwordStrength.className = 'password-strength';
            if (password.length > 0) {
                if (strength <= 2) {
                    passwordStrength.classList.add('strength-weak');
                } else if (strength <= 4) {
                    passwordStrength.classList.add('strength-medium');
                } else {
                    passwordStrength.classList.add('strength-strong');
                }
            }
        });

        // Change password form submission
        changePasswordForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const oldPassword = document.getElementById('oldPassword').value.trim();
            const newPassword = document.getElementById('newPassword').value.trim();
            const confirmNewPassword = document.getElementById('confirmNewPassword').value.trim();
            
            if (!oldPassword || !newPassword || !confirmNewPassword) {
                showError('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin');
                return;
            }
            
            if (newPassword !== confirmNewPassword) {
                showError('M·∫≠t kh·∫©u m·ªõi v√† x√°c nh·∫≠n kh√¥ng kh·ªõp');
                return;
            }
            
            if (newPassword.length < 6) {
                showError('M·∫≠t kh·∫©u m·ªõi ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±');
                return;
            }
            
            if (newPassword === oldPassword) {
                showError('M·∫≠t kh·∫©u m·ªõi ph·∫£i kh√°c m·∫≠t kh·∫©u c≈©');
                return;
            }
            
            const currentUser = getCurrentUser();
            if (!currentUser) {
                showError('B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ ƒë·ªïi m·∫≠t kh·∫©u');
                return;
            }
            
            submitChangePasswordBtn.innerHTML = '<div class="loading"></div> ƒêang c·∫≠p nh·∫≠t...';
            submitChangePasswordBtn.disabled = true;
            
            try {
                const response = await fetch(CONFIG.GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8',
                    },
                    body: JSON.stringify({
                        action: 'changePassword',
                        data: {
                            email: currentUser.email,
                            oldPassword: oldPassword,
                            newPassword: newPassword,
                            timestamp: new Date().toISOString()
                        }
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showSuccess('ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng! Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i v·ªõi m·∫≠t kh·∫©u m·ªõi.');
                    
                    setTimeout(() => {
                        changePasswordModal.classList.remove('active');
                        changePasswordForm.reset();
                        passwordStrength.className = 'password-strength';
                        
                        setTimeout(() => {
                            logoutBtn.click();
                        }, 1000);
                    }, 2000);
                    
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                showError(error.message || 'ƒê·ªïi m·∫≠t kh·∫©u th·∫•t b·∫°i');
            } finally {
                submitChangePasswordBtn.innerHTML = '<i class="fas fa-check"></i> C·∫≠p nh·∫≠t m·∫≠t kh·∫©u';
                submitChangePasswordBtn.disabled = false;
            }
        });

        // Utility functions
        async function loadUserInfo(userData, isQuickLoad) {
            console.log('loadUserInfo called with:', userData);
            
            // Hi·ªÉn th·ªã th√¥ng tin ng∆∞·ªùi d√πng ngay l·∫≠p t·ª©c
            document.getElementById('userName').textContent = userData.username || 'Ng∆∞·ªùi d√πng';
            document.getElementById('userEmail').textContent = userData.email || 'Ch∆∞a c√≥ email';
            document.getElementById('userCreatedDate').textContent = formatDate(userData.createdDate) || 'Kh√¥ng x√°c ƒë·ªãnh';
            
            // Set avatar v·ªõi ch·ªØ c√°i ƒë·∫ßu c·ªßa username
            const firstLetter = (userData.username || 'U').charAt(0).toUpperCase();
            document.getElementById('userAvatar').innerHTML = firstLetter;
            
            // Update badge v√† VIP info
            const userBadge = document.getElementById('userBadge');
            const vipExpiryDate = document.getElementById('vipExpiryDate');
            const upgradeBtn = document.getElementById('upgradeBtn');
            
            const packageInfo = {
                'free': { name: 'Mi·ªÖn ph√≠', class: 'free', icon: 'fas fa-user' },
                'trial': { name: 'Trial', class: 'trial', icon: 'fas fa-star' },
                'basic': { name: 'Basic', class: 'basic', icon: 'fas fa-crown' },
                'plus': { name: 'Plus', class: 'plus', icon: 'fas fa-crown' },
                'premium': { name: 'Premium', class: 'premium', icon: 'fas fa-crown' }
            };
            
            const packageType = userData.packageType || 'free';
            const currentPackage = packageInfo[packageType] || packageInfo.free;
            
            // C·∫≠p nh·∫≠t g√≥i t√†i kho·∫£n
            userBadge.innerHTML = `<i class="${currentPackage.icon}"></i><span>T√†i kho·∫£n ${currentPackage.name}</span>`;
            userBadge.className = `user-badge ${currentPackage.class}`;
            
            // C·∫≠p nh·∫≠t th√¥ng tin VIP expiry
            if (userData.vipExpiry && userData.vipExpiry !== '') {
                vipExpiryDate.textContent = formatDate(userData.vipExpiry);
                vipExpiryInfo.style.display = 'flex';
            } else {
                vipExpiryInfo.style.display = 'none';
            }
            
            // FIX LOGIC HI·ªÇN TH·ªä TR·∫†NG TH√ÅI VIP
            if (packageType !== 'free') {
                vipStatusInfo.style.display = 'flex';
                
                // S·ª≠ d·ª•ng tr·∫°ng th√°i t·ª´ server n·∫øu c√≥
                const vipStatus = userData.vipStatus || 'free';
                
                if (vipStatus === 'active') {
                    vipStatusText.textContent = 'ƒêang ho·∫°t ƒë·ªông';
                    vipStatusText.style.color = 'var(--success)';
                    upgradeBtn.style.display = 'none';
                } else if (vipStatus === 'expired') {
                    vipStatusText.textContent = 'ƒê√£ h·∫øt h·∫°n';
                    vipStatusText.style.color = 'var(--danger)';
                    upgradeBtn.style.display = 'flex';
                } else {
                    // Ki·ªÉm tra ng√†y h·∫øt h·∫°n ƒë·ªÉ x√°c ƒë·ªãnh
                    if (userData.vipExpiry && userData.vipExpiry !== '') {
                        const expiryDate = parseDate(userData.vipExpiry);
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);
                        
                        if (expiryDate && !isNaN(expiryDate.getTime())) {
                            expiryDate.setHours(0, 0, 0, 0);
                            
                            if (expiryDate >= today) {
                                vipStatusText.textContent = 'ƒêang ho·∫°t ƒë·ªông';
                                vipStatusText.style.color = 'var(--success)';
                                upgradeBtn.style.display = 'none';
                            } else {
                                vipStatusText.textContent = 'ƒê√£ h·∫øt h·∫°n';
                                vipStatusText.style.color = 'var(--danger)';
                                upgradeBtn.style.display = 'flex';
                            }
                        } else {
                            vipStatusText.textContent = 'Kh√¥ng x√°c ƒë·ªãnh';
                            vipStatusText.style.color = 'var(--warning)';
                            upgradeBtn.style.display = 'flex';
                        }
                    } else {
                        vipStatusText.textContent = 'Kh√¥ng x√°c ƒë·ªãnh';
                        vipStatusText.style.color = 'var(--warning)';
                        upgradeBtn.style.display = 'flex';
                    }
                }
            } else {
                vipStatusInfo.style.display = 'none';
                upgradeBtn.style.display = 'flex';
            }
            
            // ·∫®N form ƒëƒÉng nh·∫≠p v√† HI·ªÜN th√¥ng tin user
            authFormsContainer.style.display = 'none';
            welcomeSection.style.display = 'none';
            userInfo.style.display = 'block';
            userInfo.classList.add('active');
            quickLoading.style.display = 'none';
            
            console.log('User info displayed, auth forms hidden');
            
            // C·∫≠p nh·∫≠t th·ªùi gian refresh
            lastRefreshTime = new Date().toLocaleTimeString('vi-VN');
            lastRefreshTimeElement.textContent = lastRefreshTime;
            
            // B·∫¨T AUTO REFRESH
            if (userData.email) {
                startAutoRefresh(userData.email);
            }
        }

        async function refreshUserInfo(userData) {
            try {
                const response = await fetch(`${CONFIG.GOOGLE_SCRIPT_URL}?action=autoRefreshUser&email=${encodeURIComponent(userData.email)}`);
                const result = await response.json();
                
                if (result.success) {
                    const updatedUserData = result.data;
                    localStorage.setItem('currentUser', JSON.stringify(updatedUserData));
                    updateUserUI(updatedUserData);
                    
                    lastRefreshTime = new Date().toLocaleTimeString('vi-VN');
                    lastRefreshTimeElement.textContent = lastRefreshTime;
                } else {
                    throw new Error('Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t th√¥ng tin');
                }
            } catch (error) {
                console.error('L·ªói khi t·∫£i th√¥ng tin ng∆∞·ªùi d√πng:', error);
                updateUserUI(userData);
            }
        }

        function getCurrentUser() {
            const userStr = localStorage.getItem('currentUser');
            return userStr ? JSON.parse(userStr) : null;
        }

        function showSuccess(message) {
            successText.textContent = message;
            successMessage.style.display = 'flex';
            errorMessage.style.display = 'none';
            
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 3000);
        }

        function showError(message) {
            errorText.textContent = message;
            errorMessage.style.display = 'flex';
            successMessage.style.display = 'none';
            
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // T·∫°o token x√°c th·ª±c human interaction
        async function generateHumanToken() {
            const timestamp = Date.now();
            const userAgent = navigator.userAgent;
            const screenInfo = `${screen.width}x${screen.height}`;
            const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            
            // T·∫°o token t·ª´ th√¥ng tin tr√¨nh duy·ªát
            const tokenData = `${timestamp}:${userAgent}:${screenInfo}:${timezone}`;
            const encoder = new TextEncoder();
            const data = encoder.encode(tokenData);
            
            // S·ª≠ d·ª•ng subtle crypto n·∫øu c√≥
            if (window.crypto && window.crypto.subtle) {
                const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                return hashArray.map(b => b.toString(16).padStart(2, '0')).join('').slice(0, 32);
            } else {
                // Fallback simple hash
                return btoa(tokenData).slice(0, 32);
            }
        }

        // Ghi log h·ª£p ph√°p
        function logLegalActivity(action, details) {
            const logEntry = {
                timestamp: new Date().toISOString(),
                action: action,
                details: details,
                userAgent: navigator.userAgent,
                referrer: document.referrer
            };
            
            console.log('Legal Activity:', logEntry);
            
            // C√≥ th·ªÉ l∆∞u v√†o localStorage ƒë·ªÉ debug
            try {
                const logs = JSON.parse(localStorage.getItem('legalLogs') || '[]');
                logs.push(logEntry);
                if (logs.length > 100) logs.shift(); // Gi·ªõi h·∫°n 100 log
                localStorage.setItem('legalLogs', JSON.stringify(logs));
            } catch (e) {
                console.warn('Could not save legal log');
            }
        }

        // Ghi log khi ng∆∞·ªùi d√πng th·ª±c hi·ªán c√°c h√†nh ƒë·ªông h·ª£p ph√°p
        document.addEventListener('DOMContentLoaded', function() {
            logLegalActivity('page_load', { page: 'account.html' });
        });

        loginForm.addEventListener('submit', function() {
            logLegalActivity('login_attempt', { 
                username: document.getElementById('loginUsername').value.substring(0, 3) + '***' 
            });
        });

        registerForm.addEventListener('submit', function() {
            logLegalActivity('register_attempt', { 
                email: document.getElementById('registerEmail').value.substring(0, 3) + '***',
                consented: privacyConsent.checked
            });
        });

        // Th√™m s·ª± ki·ªán click cho footer links
        document.querySelectorAll('.footer-link').forEach(link => {
            link.addEventListener('click', function(e) {
                logLegalActivity('legal_link_click', { 
                    link: this.href,
                    text: this.textContent 
                });
            });
        });
    </script>
</body>
</html>
